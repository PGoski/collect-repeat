angular.module("collectRepeat",[]).factory("$repeatFactory",["$animate","$ionicPosition",function(e,t){var n=function(e,t){this.map=t,this.collection=e,this.startIndex=0,this.endIndex=null,this.upperThreshold=0,this.lowerThreshold=null,this.itemHeight=null,this.inViewCount=null,this.scrollHeight=null,this.parentElement=null,this.parentHeight=null};return n.prototype={setDefaults:function(e,n){var i=t.offset(e),l=Math.round(i.height);this.windowHeight=n,this.itemHeight=l,this.parentHeight=(this.collection.length+1)*this.itemHeight,this.inViewCount=Math.ceil(this.windowHeight/this.itemHeight+4),this.scrollHeight=this.inViewCount*this.itemHeight,this.endIndex=this.collection.length<this.inViewCount?this.collection.length-1:this.inViewCount-1;var o=this.scrollHeight;this.setThreshold("lower",o)},setThreshold:function(e,t){"upper"===e?this.upperThreshold=t:"lower"===e&&(this.lowerThreshold=t)}},{RepeatManager:n,createMap:function(){return Object.create(null)},updateScope:function(e){var t=e.scope;t[e.valueIdentifier]=e.value,t.$index=e.index,t.$first=0===e.index,t.$last=e.index===e.arrayLength-1,t.$middle=!(t.$first||t.$last),t.$odd=!(t.$even=0===(1&e.index))},transcludeClone:function(e,t){},renderClone:function(){}}}]).directive("collectRepeat",["$animate","$repeatFactory","$ionicPosition",function(e,t,n){return{restrict:"A",priority:1e3,transclude:"element",compile:function(i,l){var o=l.collectRepeat,a=o.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)?\s*$/),r=a[1],s=a[2];return function(i,l,o,a,c){var u=t.createMap(),h=new t.RepeatManager(i.collection,u);h.parentElement=l[0].parentElement,i.$watchCollection(s,function(o){var a,s,u,d,p=l[0];s=o.length;var m=document.getElementsByClassName("scroll-content"),f=m[0].clientHeight;for("undefined"==typeof h.map[u]&&(a=u=0,c(function(n,i){n[0].style.position="absolute",n[0].style.width="100%",n[0].style.transform=n[0].style.webkitTransform="translate3d(0,"+(h.itemHeight*a+"px")+",0)",e.enter(n,null,angular.element(p)),p=n;var l={scope:i,index:a,valueIdentifier:r,value:d,key:u,collectionLength:s};t.updateScope(l),h.map[u]={index:0,value:o[u],clone:n,scope:i,previousNode:null},h.setDefaults(n,f)})),h.parentElement.style.position="relative",h.parentElement.style.height=h.parentHeight+"px",a=h.startIndex+1;a<h.inViewCount;a++)u=a,d=o[u],"undefined"==typeof h.map[u]?c(function(n,i){n[0].style.position="absolute",n[0].style.width="100%",n[0].style.transform=n[0].style.webkitTransform="translate3d(0,"+(h.itemHeight*a+"px")+",0)",e.enter(n,null,angular.element(p)),p=n;var l={scope:i,index:a,valueIdentifier:r,value:d,key:u,collectionLength:s};t.updateScope(l),h.map[u]={index:u,value:o[u],clone:n,scope:i,previousNode:p}}):e.enter(h.map[u].clone,null,angular.element(h.map[u].previousNode));i.currentScroll=0,angular.element(m[0]).on("scroll",function(e){i.currentScroll=n.offset(h.map[h.startIndex].clone).top,i.$apply()}),i.$watch("currentScroll",function(n){n<=-h.itemHeight&&h.endIndex<h.collection.length?(h.endIndex++,u=a=h.endIndex,"undefined"==typeof h.map[u]?c(function(n,i){n[0].style.position="absolute",n[0].style.width="100%",n[0].style.transform=n[0].style.webkitTransform="translate3d(0,"+(h.itemHeight*a+"px")+",0)",e.enter(n,null,angular.element(p)),p=n;var l={scope:i,index:a,valueIdentifier:r,value:d,key:u,collectionLength:s};t.updateScope(l),h.map[u]={index:u,value:o[u],clone:n,scope:i,previousNode:p}}):e.enter(h.map[h.endIndex].clone,h.parentElement),h.startIndex>0&&(e.leave(h.map[--h.startIndex].clone),h.startIndex++),i.currentIndex=h.map[h.startIndex++].clone):n>=h.itemHeight&&h.startIndex>0&&(h.startIndex--,e.enter(h.map[h.startIndex].clone,null,l[0]),e.leave(h.map[h.endIndex].clone),h.endIndex--)})})}}}}]);